### [CVE-2024-26996](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-26996)
![](https://img.shields.io/static/v1?label=Product&message=Linux&color=blue)
![](https://img.shields.io/static/v1?label=Version&message=1da177e4c3f4%3C%207f67c2020cb0%20&color=brighgreen)
![](https://img.shields.io/static/v1?label=Vulnerability&message=n%2Fa&color=brighgreen)

### Description

In the Linux kernel, the following vulnerability has been resolved:usb: gadget: f_ncm: Fix UAF ncm object at re-bind after usb ep transport errorWhen ncm function is working and then stop usb0 interface for link down,eth_stop() is called. At this piont, accidentally if usb transport errorshould happen in usb_ep_enable(), 'in_ep' and/or 'out_ep' may not be enabled.After that, ncm_disable() is called to disable for ncm unbindbut gether_disconnect() is never called since 'in_ep' is not enabled.As the result, ncm object is released in ncm unbindbut 'dev->port_usb' associated to 'ncm->port' is not NULL.And when ncm bind again to recover netdev, ncm object is reallocatedbut usb0 interface is already associated to previous released ncm object.Therefore, once usb0 interface is up and eth_start_xmit() is called,released ncm object is dereferrenced and it might cause use-after-free memory.[function unlink via configfs]  usb0: eth_stop dev->port_usb=ffffff9b179c3200  --> error happens in usb_ep_enable().  NCM: ncm_disable: ncm=ffffff9b179c3200  --> no gether_disconnect() since ncm->port.in_ep->enabled is false.  NCM: ncm_unbind: ncm unbind ncm=ffffff9b179c3200  NCM: ncm_free: ncm free ncm=ffffff9b179c3200   <-- released ncm[function link via configfs]  NCM: ncm_alloc: ncm alloc ncm=ffffff9ac4f8a000  NCM: ncm_bind: ncm bind ncm=ffffff9ac4f8a000  NCM: ncm_set_alt: ncm=ffffff9ac4f8a000 alt=0  usb0: eth_open dev->port_usb=ffffff9b179c3200  <-- previous released ncm  usb0: eth_start dev->port_usb=ffffff9b179c3200 <--  eth_start_xmit()  --> dev->wrap()  Unable to handle kernel paging request at virtual address dead00000000014fThis patch addresses the issue by checking if 'ncm->netdev' is not NULL atncm_disable() to call gether_disconnect() to deassociate 'dev->port_usb'.It's more reasonable to check 'ncm->netdev' to call gether_connect/disconnectrather than check 'ncm->port.in_ep->enabled' since it might not be enabledbut the gether connection might be established.

### POC

#### Reference
No PoCs from references.

#### Github
- https://github.com/fkie-cad/nvd-json-data-feeds

