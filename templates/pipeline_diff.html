{% extends "pipeline_base.html" %}
{% block title %}Diff {{ diff.generated or generated }}{% endblock %}
{% block content %}
  <section>
    <div class="section-header">
      <div>
        <p class="eyebrow">Daily delta</p>
        <h1>Diff for {{ diff.generated }}</h1>
      </div>
      <a class="text-link" href="/api/v1/diffs/{{ diff.generated }}.json">JSON</a>
    </div>

    <div class="grid-2">
      <div>
        <h3>New high-confidence PoCs</h3>
        <ul class="list">
          {% for item in diff.new_high_conf_pocs %}
            <li>
              <span class="pill">+ High</span>
              <a href="/cve/{{ item.cve_id }}.html">{{ item.cve_id }}</a>
              <a href="https://github.com/{{ item.repo_full_name }}" target="_blank" rel="noreferrer">{{ item.repo_full_name }}</a>
            </li>
          {% else %}
            <li class="muted">No new high-confidence entries.</li>
          {% endfor %}
        </ul>
      </div>
      <div>
        <h3>Promoted to high</h3>
        <ul class="list">
          {% for item in diff.promoted_to_high %}
            <li>
              <span class="pill">↗</span>
              <a href="/cve/{{ item.cve_id }}.html">{{ item.cve_id }}</a>
              <a href="https://github.com/{{ item.repo_full_name }}" target="_blank" rel="noreferrer">{{ item.repo_full_name }}</a>
              <span class="muted small">(prev {{ item.previous_tier }})</span>
            </li>
          {% else %}
            <li class="muted">No promotions this run.</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="grid-2">
      <div>
        <h3>Demoted or removed</h3>
        <ul class="list">
          {% for item in diff.demoted_or_removed %}
            <li>
              <span class="pill warn">↘</span>
              <a href="/cve/{{ item.cve_id }}.html">{{ item.cve_id }}</a>
              <span class="muted small">{{ item.repo_full_name }}</span>
            </li>
          {% else %}
            <li class="muted">No removals.</li>
          {% endfor %}
        </ul>
      </div>
      <div>
        <h3>Dead links (optional checks)</h3>
        <ul class="list">
          {% for item in diff.dead_links %}
            <li><span class="pill warn">offline</span> <a href="{{ item.url }}">{{ item.url }}</a></li>
          {% else %}
            <li class="muted">Link checks skipped or none failed.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </section>
{% endblock %}
