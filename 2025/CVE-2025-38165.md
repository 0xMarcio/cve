### [CVE-2025-38165](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-38165)
![](https://img.shields.io/static/v1?label=Product&message=Linux&color=blue)
![](https://img.shields.io/static/v1?label=Version&message=&color=brightgreen)
![](https://img.shields.io/static/v1?label=Version&message=6.6%20&color=brightgreen)
![](https://img.shields.io/static/v1?label=Version&message=65ad600b9bde68d2d28709943ab00b51ca8f0a1d%20&color=brightgreen)
![](https://img.shields.io/static/v1?label=Version&message=923877254f002ae87d441382bb1096d9e773d56d%20&color=brightgreen)
![](https://img.shields.io/static/v1?label=Version&message=a454d84ee20baf7bd7be90721b9821f73c7d23d9%20&color=brightgreen)
![](https://img.shields.io/static/v1?label=Version&message=e6b5e47adb9166e732cdf7e6e034946e3f89f36d%20&color=brightgreen)
![](https://img.shields.io/static/v1?label=Vulnerability&message=n%2Fa&color=blue)

### Description

In the Linux kernel, the following vulnerability has been resolved:bpf, sockmap: Fix panic when calling skb_linearizeThe panic can be reproduced by executing the command:./bench sockmap -c 2 -p 1 -a --rx-verdict-ingress --rx-strp 100000Then a kernel panic was captured:'''[  657.460555] kernel BUG at net/core/skbuff.c:2178![  657.462680] Tainted: [W]=WARN[  657.463287] Workqueue: events sk_psock_backlog...[  657.469610]  <TASK>[  657.469738]  ? die+0x36/0x90[  657.469916]  ? do_trap+0x1d0/0x270[  657.470118]  ? pskb_expand_head+0x612/0xf40[  657.470376]  ? pskb_expand_head+0x612/0xf40[  657.470620]  ? do_error_trap+0xa3/0x170[  657.470846]  ? pskb_expand_head+0x612/0xf40[  657.471092]  ? handle_invalid_op+0x2c/0x40[  657.471335]  ? pskb_expand_head+0x612/0xf40[  657.471579]  ? exc_invalid_op+0x2d/0x40[  657.471805]  ? asm_exc_invalid_op+0x1a/0x20[  657.472052]  ? pskb_expand_head+0xd1/0xf40[  657.472292]  ? pskb_expand_head+0x612/0xf40[  657.472540]  ? lock_acquire+0x18f/0x4e0[  657.472766]  ? find_held_lock+0x2d/0x110[  657.472999]  ? __pfx_pskb_expand_head+0x10/0x10[  657.473263]  ? __kmalloc_cache_noprof+0x5b/0x470[  657.473537]  ? __pfx___lock_release.isra.0+0x10/0x10[  657.473826]  __pskb_pull_tail+0xfd/0x1d20[  657.474062]  ? __kasan_slab_alloc+0x4e/0x90[  657.474707]  sk_psock_skb_ingress_enqueue+0x3bf/0x510[  657.475392]  ? __kasan_kmalloc+0xaa/0xb0[  657.476010]  sk_psock_backlog+0x5cf/0xd70[  657.476637]  process_one_work+0x858/0x1a20'''The panic originates from the assertion BUG_ON(skb_shared(skb)) inskb_linearize(). A previous commit(see Fixes tag) introduced skb_get()to avoid race conditions between skb operations in the backlog and skbrelease in the recvmsg path. However, this caused the panic to alwaysoccur when skb_linearize is executed.The "--rx-strp 100000" parameter forces the RX path to use the strparsermodule which aggregates data until it reaches 100KB before calling sockmaplogic. The 100KB payload exceeds MAX_MSG_FRAGS, triggering skb_linearize.To fix this issue, just move skb_get into sk_psock_skb_ingress_enqueue.'''sk_psock_backlog:    sk_psock_handle_skb       skb_get(skb) <== we move it into 'sk_psock_skb_ingress_enqueue'       sk_psock_skb_ingress____________                                       ↓                                       |                                       | → sk_psock_skb_ingress_self                                       |      sk_psock_skb_ingress_enqueuesk_psock_verdict_apply_________________↑          skb_linearize'''Note that for verdict_apply path, the skb_get operation is unnecessary sowe add 'take_ref' param to control it's behavior.

### POC

#### Reference
No PoCs from references.

#### Github
- https://github.com/w4zu/Debian_security

