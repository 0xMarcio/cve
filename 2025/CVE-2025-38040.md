### [CVE-2025-38040](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-38040)
![](https://img.shields.io/static/v1?label=Product&message=Linux&color=blue)
![](https://img.shields.io/static/v1?label=Version&message=&color=brightgreen)
![](https://img.shields.io/static/v1?label=Version&message=1da177e4c3f41524e886b7f1b8a0c1fc7321cac2%20&color=brightgreen)
![](https://img.shields.io/static/v1?label=Vulnerability&message=n%2Fa&color=blue)

### Description

In the Linux kernel, the following vulnerability has been resolved:serial: mctrl_gpio: split disable_ms into sync and no_sync APIsThe following splat has been observed on a SAMA5D27 platform usingatmel_serial:BUG: sleeping function called from invalid context at kernel/irq/manage.c:738in_atomic(): 1, irqs_disabled(): 128, non_block: 0, pid: 27, name: kworker/u5:0preempt_count: 1, expected: 0INFO: lockdep is turned off.irq event stamp: 0hardirqs last  enabled at (0): [<00000000>] 0x0hardirqs last disabled at (0): [<c01588f0>] copy_process+0x1c4c/0x7becsoftirqs last  enabled at (0): [<c0158944>] copy_process+0x1ca0/0x7becsoftirqs last disabled at (0): [<00000000>] 0x0CPU: 0 UID: 0 PID: 27 Comm: kworker/u5:0 Not tainted 6.13.0-rc7+ #74Hardware name: Atmel SAMA5Workqueue: hci0 hci_power_on [bluetooth]Call trace:  unwind_backtrace from show_stack+0x18/0x1c  show_stack from dump_stack_lvl+0x44/0x70  dump_stack_lvl from __might_resched+0x38c/0x598  __might_resched from disable_irq+0x1c/0x48  disable_irq from mctrl_gpio_disable_ms+0x74/0xc0  mctrl_gpio_disable_ms from atmel_disable_ms.part.0+0x80/0x1f4  atmel_disable_ms.part.0 from atmel_set_termios+0x764/0x11e8  atmel_set_termios from uart_change_line_settings+0x15c/0x994  uart_change_line_settings from uart_set_termios+0x2b0/0x668  uart_set_termios from tty_set_termios+0x600/0x8ec  tty_set_termios from ttyport_set_flow_control+0x188/0x1e0  ttyport_set_flow_control from wilc_setup+0xd0/0x524 [hci_wilc]  wilc_setup [hci_wilc] from hci_dev_open_sync+0x330/0x203c [bluetooth]  hci_dev_open_sync [bluetooth] from hci_dev_do_open+0x40/0xb0 [bluetooth]  hci_dev_do_open [bluetooth] from hci_power_on+0x12c/0x664 [bluetooth]  hci_power_on [bluetooth] from process_one_work+0x998/0x1a38  process_one_work from worker_thread+0x6e0/0xfb4  worker_thread from kthread+0x3d4/0x484  kthread from ret_from_fork+0x14/0x28This warning is emitted when trying to toggle, at the highest level,some flow control (with serdev_device_set_flow_control) in a devicedriver. At the lowest level, the atmel_serial driver is usingserial_mctrl_gpio lib to enable/disable the corresponding IRQsaccordingly.  The warning emitted by CONFIG_DEBUG_ATOMIC_SLEEP is due todisable_irq (called in mctrl_gpio_disable_ms) being possibly called insome atomic context (some tty drivers perform modem lines configurationin regions protected by port lock).Split mctrl_gpio_disable_ms into two differents APIs, a non-blocking oneand a blocking one. Replace mctrl_gpio_disable_ms calls with therelevant version depending on whether the call is protected by some portlock.

### POC

#### Reference
No PoCs from references.

#### Github
- https://github.com/w4zu/Debian_security

